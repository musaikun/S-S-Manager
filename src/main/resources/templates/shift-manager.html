<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフト登録 - S×S Manager</title>
    <link rel="stylesheet" href="/css/calendar_css/calendar.css?v=1762263384">
    <link rel="stylesheet" href="/css/timeregister_css/timeregister.css?v=1762263384">
    <link rel="stylesheet" href="/css/shift-manager.css?v=1762263384">
</head>
<body>
    <!-- 固定の進捗インジケーター -->
    <div class="progress-indicator-fixed">
        <div class="progress-indicator">
            <div class="progress-step" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">日付選択</div>
            </div>
            <div class="progress-line"></div>
            <div class="progress-step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">時間設定</div>
            </div>
            <div class="progress-line"></div>
            <div class="progress-step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">確認・提出</div>
            </div>
        </div>
    </div>

    <!-- スライドビューコンテナ -->
    <div class="view-container">
        <div class="view-wrapper" id="viewWrapper">

            <!-- ビュー1: カレンダー -->
            <div class="view calendar-view" id="calendarView">
                <div class="container">
                    <div class="card">
                        <h1 class="title">勤務日カレンダー</h1>

                        <!-- 操作セクション -->
                        <div class="controls">
                            <div class="month-selector">
                                <button id="thisMonthBtn" class="btn-month active">今月</button>
                                <button id="nextMonthBtn" class="btn-month">来月</button>
                            </div>

                            <div class="button-group">
                                <button id="selectAllBtn" class="btn-action">全日選択</button>
                                <button id="clearAllBtn" class="btn btn-secondary">選択をすべてクリア</button>
                            </div>

                            <div class="weekday-buttons">
                                <button class="btn-weekday btn-sun" data-day="0">日</button>
                                <button class="btn-weekday" data-day="1">月</button>
                                <button class="btn-weekday" data-day="2">火</button>
                                <button class="btn-weekday" data-day="3">水</button>
                                <button class="btn-weekday" data-day="4">木</button>
                                <button class="btn-weekday" data-day="5">金</button>
                                <button class="btn-weekday btn-sat" data-day="6">土</button>
                            </div>
                        </div>

                        <!-- カレンダーグリッド -->
                        <div class="calendar-wrapper">
                            <div class="calendar-header">
                                <div class="day-name sun">日</div>
                                <div class="day-name">月</div>
                                <div class="day-name">火</div>
                                <div class="day-name">水</div>
                                <div class="day-name">木</div>
                                <div class="day-name">金</div>
                                <div class="day-name sat">土</div>
                            </div>
                            <div id="calendarGrid" class="calendar-grid"></div>
                        </div>

                        <!-- 選択リスト -->
                        <div class="selection-section">
                            <div class="selection-content">
                                <div class="total-days">
                                    合計勤務日数: <span id="totalDays">0</span>日
                                </div>
                                <button id="nextToTimeBtn" class="btn btn-next" disabled>時間設定へ進む →</button>
                            </div>
                            <div class="month-info">
                                <span id="monthInfo">11月の平日は20日、休日は10日です</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ビュー2: 時間設定 -->
            <div class="view time-register-view" id="timeRegisterView">
                <div class="container">
                    <div class="card">
                        <h1 class="title">勤務時間の設定</h1>
                        <p class="subtitle">各日の勤務時間を設定してください</p>

                        <!-- 一括設定セクション - アコーディオン -->
                        <div class="accordion">
                            <button class="accordion-header" id="bulkAccordionBtn">
                                <span>一括設定</span>
                                <span class="accordion-icon">▼</span>
                            </button>
                            <div class="accordion-content" id="bulkAccordionContent">
                                <!-- 開始・終了時間表示 -->
                                <div class="bulk-time-compact">
                                    <div class="bulk-time-item">
                                        <span class="bulk-time-label">開始</span>
                                        <button id="bulkStartTimeBtn" class="time-display-btn">
                                            <span id="bulkStartTimeDisplay">09:00</span>
                                        </button>
                                    </div>
                                    <div class="bulk-time-item">
                                        <span class="bulk-time-label">終了</span>
                                        <button id="bulkEndTimeBtn" class="time-display-btn">
                                            <span id="bulkEndTimeDisplay">18:00</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- 適用ボタン -->
                                <div class="bulk-apply-buttons">
                                    <button id="applyAllBtn" class="btn btn-primary btn-full">開始、終了時間を全日に設定</button>
                                    <button id="applyStartBtn" class="btn btn-apply btn-full">開始時間のみ全日に設定</button>
                                    <button id="applyEndBtn" class="btn btn-apply btn-full">終了時間のみ全日に設定</button>
                                </div>

                                <!-- 曜日別一括設定 -->
                                <div class="weekday-bulk-section">
                                    <p class="weekday-bulk-label">設定した時間を曜日別に設定</p>
                                    <div class="weekday-bulk-buttons-compact">
                                        <button class="btn-weekday-compact btn-sun" data-day="0">日</button>
                                        <button class="btn-weekday-compact" data-day="1">月</button>
                                        <button class="btn-weekday-compact" data-day="2">火</button>
                                        <button class="btn-weekday-compact" data-day="3">水</button>
                                        <button class="btn-weekday-compact" data-day="4">木</button>
                                        <button class="btn-weekday-compact" data-day="5">金</button>
                                        <button class="btn-weekday-compact btn-sat" data-day="6">土</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 個別時間設定リスト -->
                        <div class="time-list-section">
                            <h2 class="section-title">個別設定</h2>
                            <p class="hint-text">※各カードをタップして時間を設定できます</p>
                            <p class="hint-text">※個別で設定した日は黄色で表示されます</p>
                            <div class="time-list-compact" id="timeList">
                                <!-- JavaScriptで動的生成 -->
                            </div>
                        </div>

                        <!-- 休憩加味チェックボックス -->
                        <div class="break-settings">
                            <div class="break-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="breakCheckbox" class="checkbox-input">
                                    <span class="checkbox-text">休憩を加味した時間を表示する</span>
                                </label>

                                <button class="help-icon" id="helpBtn" title="休憩時間の計算ルール">
                                    ❓
                                </button>
                            </div>
                        </div>

                        <!-- 合計表示 -->
                        <div class="summary-section">
                            <div class="summary-item">
                                <div class="summary-label">出勤日</div>
                                <div class="summary-value"><span id="totalWorkDays">0</span>日</div>
                            </div>
                            <div class="summary-item" id="normalWorkHoursItem">
                                <div class="summary-label">労働時間</div>
                                <div class="summary-value" id="totalHours">0時間</div>
                            </div>
                            <div class="summary-item" id="actualWorkHoursItem" style="display: none;">
                                <div class="summary-label">実労働時間</div>
                                <div class="summary-value" id="actualHours">0時間</div>
                            </div>
                            <div class="summary-item" id="totalBreakItem" style="display: none;">
                                <div class="summary-label">休憩時間</div>
                                <div class="summary-value" id="totalBreakTime">0分</div>
                            </div>
                        </div>

                        <!-- アクションボタン -->
                        <div class="action-buttons">
                            <button id="backToCalendarBtn" class="btn btn-secondary btn-full-width">← カレンダーに戻る</button>
                            <button id="submitBtn" class="btn btn-primary btn-full-width">シフトを提出する</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ヘルプオーバーレイ -->
    <div id="helpOverlay" class="help-overlay" style="display: none;">
        <div class="help-popup">
            <button class="help-close" id="helpClose">×</button>
            <div class="help-content">
                <p class="help-title">休憩時間の計算ルール</p>
                <div class="help-table">
                    <div class="help-row">
                        <div class="help-cell help-label">6時間未満</div>
                        <div class="help-cell help-value">休憩なし</div>
                    </div>
                    <div class="help-row">
                        <div class="help-cell help-label">6時間以上8時間未満</div>
                        <div class="help-cell help-value">45分</div>
                    </div>
                    <div class="help-row">
                        <div class="help-cell help-label">8時間以上</div>
                        <div class="help-cell help-value">60分（1時間）</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- タイムピッカーモーダル -->
    <div id="timePickerModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modalTitle">勤務時間の設定</h3>

            <!-- 開始時間 -->
            <div class="modal-section">
                <div class="modal-section-header">
                    <label class="modal-label" style="margin-bottom: 0;">開始時間</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="startPeriodToggle" class="toggle-input">
                        <label for="startPeriodToggle" class="toggle-label">
                            <span class="toggle-text-am">午前</span>
                            <span class="toggle-text-pm">午後</span>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="hour-selector-row">
                    <div class="hour-selector-inline" id="startHourSelector"></div>
                </div>

                <div class="minute-selector-row">
                    <button class="minute-btn-inline" data-minute="00" data-target="start">00</button>
                    <button class="minute-btn-inline" data-minute="15" data-target="start">15</button>
                    <button class="minute-btn-inline" data-minute="30" data-target="start">30</button>
                    <button class="minute-btn-inline" data-minute="45" data-target="start">45</button>
                </div>

                <div class="time-preview">選択: <span id="startTimePreview">--:--</span></div>
            </div>

            <!-- 終了時間 -->
            <div class="modal-section">
                <div class="modal-section-header">
                    <label class="modal-label" style="margin-bottom: 0;">終了時間</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="endPeriodToggle" class="toggle-input" checked>
                        <label for="endPeriodToggle" class="toggle-label">
                            <span class="toggle-text-am">午前</span>
                            <span class="toggle-text-pm">午後</span>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="hour-selector-row">
                    <div class="hour-selector-inline" id="endHourSelector"></div>
                </div>

                <div class="minute-selector-row">
                    <button class="minute-btn-inline" data-minute="00" data-target="end">00</button>
                    <button class="minute-btn-inline" data-minute="15" data-target="end">15</button>
                    <button class="minute-btn-inline" data-minute="30" data-target="end">30</button>
                    <button class="minute-btn-inline" data-minute="45" data-target="end">45</button>
                </div>

                <div class="time-preview">選択: <span id="endTimePreview">--:--</span></div>
            </div>

            <div class="modal-work-hours">
                勤務時間: <span id="modalWorkHours">9時間</span>
            </div>

            <div class="modal-buttons">
                <button id="modalConfirm" class="btn btn-primary btn-full-width">設定する</button>
                <div class="modal-buttons-row">
                    <button id="modalCancel" class="btn btn-secondary">キャンセル</button>
                    <button id="removeShiftBtn" class="btn btn-danger" style="display:none;">シフトを外す</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3択ダイアログ -->
    <div id="threeChoiceDialog" class="dialog-overlay">
        <div class="dialog">
            <h3>一括設定の確認</h3>
            <p id="threeChoiceMessage" class="dialog-message"></p>
            <div class="three-choice-buttons">
                <button id="choiceModifiedOnly" class="btn btn-choice">個別設定した日以外を変更</button>
                <button id="choiceAll" class="btn btn-choice btn-primary">すべて変更</button>
                <button id="choiceCancel" class="btn btn-secondary">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- カスタムアラート/確認ダイアログ -->
    <div id="customDialog" class="help-overlay" style="display: none;">
        <div class="help-popup custom-dialog-popup">
            <button class="help-close" id="customDialogClose">×</button>
            <div class="help-content">
                <p class="help-title" id="customDialogMessage">確認</p>
                <div class="dialog-buttons" id="customDialogButtons" style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="customDialogCancel" class="btn btn-secondary" style="flex: 1;">キャンセル</button>
                    <button id="customDialogOk" class="btn btn-primary" style="flex: 1;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 確認ダイアログ（シフト提出） -->
    <div id="confirmDialog" class="dialog-overlay">
        <div class="dialog dialog-large">
            <h3>シフト提出内容の最終確認</h3>
            <div id="confirmList" class="confirm-list"></div>
            <div class="confirm-total">
                <span>合計: <span id="confirmTotalDays">0</span>日 / <span id="confirmTotalHours">0</span>時間</span>
            </div>
            <div class="dialog-buttons">
                <button id="cancelSubmit" class="btn btn-secondary">修正する</button>
                <button id="finalSubmit" class="btn btn-primary btn-large">提出する</button>
            </div>
        </div>
    </div>

    <!-- 既存JSファイルが期待するダミー要素（display:noneで非表示） -->
    <div style="display: none;">
        <button id="confirmYes"></button>
        <button id="confirmNo"></button>
        <button id="submitYes"></button>
        <button id="submitNo"></button>
        <button id="nextBtn"></button>
        <button id="templateSaveYes"></button>
        <button id="templateSaveNo"></button>
    </div>

    <!-- JavaScriptファイル読み込み（shift-manager.jsで変数を宣言し、その後に他のJSを読み込む） -->
    <script src="/js/shift-manager.js?v=1762263384"></script>
    <script src="/js/calendar_js/calendar.js?v=1762263384"></script>
    <script src="/js/timeregister_js/timeregister.js?v=1762263384"></script>

    <!-- 著作権表示 -->
    <footer style="text-align: center; margin-top: 2rem; padding: 1rem 0; color: white; font-size: 0.875rem;">
        © 2025 無才 / S×S Manager
    </footer>
</body>
</html>
